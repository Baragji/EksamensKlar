<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Quiz Module Tests</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .test-container { 
            background: white; 
            color: #333;
            border-radius: 15px; 
            padding: 25px; 
            margin: 20px 0; 
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        .test-section { 
            border: 2px solid #e0e0e0; 
            border-radius: 10px; 
            padding: 20px; 
            margin: 15px 0; 
        }
        .test-passed { border-color: #4caf50; background: #e8f5e8; }
        .test-failed { border-color: #f44336; background: #ffeaea; }
        .test-pending { border-color: #ff9800; background: #fff3e0; }
        .btn { 
            background: #2196f3; 
            color: white; 
            border: none; 
            padding: 12px 24px; 
            border-radius: 6px; 
            cursor: pointer; 
            margin: 5px;
            font-size: 16px;
        }
        .btn:hover { background: #1976d2; }
        .btn.success { background: #4caf50; }
        .btn.danger { background: #f44336; }
        .quiz-preview { 
            border: 1px solid #ddd; 
            border-radius: 8px; 
            padding: 15px; 
            margin: 10px 0; 
            background: #f9f9f9;
        }
        .option { 
            background: #f0f0f0; 
            padding: 10px; 
            margin: 5px 0; 
            border-radius: 5px; 
            cursor: pointer;
            transition: background 0.2s;
        }
        .option:hover { background: #e0e0e0; }
        .option.correct { background: #c8e6c9; }
        .option.incorrect { background: #ffcdd2; }
        .results { 
            background: #f5f5f5; 
            padding: 15px; 
            border-radius: 8px; 
            margin: 10px 0;
        }
        .log { 
            background: #f5f5f5; 
            padding: 10px; 
            border-radius: 5px; 
            margin: 10px 0; 
            font-family: monospace; 
            max-height: 200px; 
            overflow-y: auto;
        }
        h1 { text-align: center; margin-bottom: 30px; }
        h2 { color: #1976d2; border-bottom: 2px solid #e3f2fd; padding-bottom: 10px; }
        h3 { color: #666; }
    </style>
</head>
<body>
    <h1>üß™ Quiz Module Tests</h1>
    
    <div class="test-container">
        <h2>üìã Test Overview</h2>
        <p>Disse tests validerer alle aspekter af quiz systemet med focus p√• user-generated content og zero dependencies.</p>
        
        <div id="testSummary" class="results">
            <strong>Test Status:</strong> <span id="testStatus">Pending...</span><br>
            <strong>Passed:</strong> <span id="passedCount">0</span> | 
            <strong>Failed:</strong> <span id="failedCount">0</span> | 
            <strong>Total:</strong> <span id="totalCount">0</span>
        </div>
        
        <button class="btn" onclick="runAllTests()">üöÄ Run All Tests</button>
        <button class="btn" onclick="clearResults()">üóëÔ∏è Clear Results</button>
    </div>

    <!-- Test 1: Quiz Data Structure -->
    <div class="test-container">
        <div id="test1" class="test-section test-pending">
            <h3>Test 1: Quiz Data Structure & Validation</h3>
            <p>Validerer at quiz data strukturen er korrekt og user-generated</p>
            
            <div class="quiz-preview">
                <h4>Sample Quiz Question:</h4>
                <div id="sampleQuestion">Loading...</div>
            </div>
            
            <button class="btn" onclick="testQuizDataStructure()">Run Test</button>
            <div id="test1Result" class="log"></div>
        </div>
    </div>

    <!-- Test 2: Quiz Engine Logic -->
    <div class="test-container">
        <div id="test2" class="test-section test-pending">
            <h3>Test 2: Quiz Engine & Question Management</h3>
            <p>Test quiz engine, randomization, og question selection</p>
            
            <div class="quiz-preview">
                <h4>Quiz Engine Preview:</h4>
                <div id="quizEngineDemo">
                    <div>Current Question: <span id="currentQuestionNum">-</span></div>
                    <div>Total Questions: <span id="totalQuestions">-</span></div>
                    <div>Score: <span id="currentScore">-</span></div>
                </div>
            </div>
            
            <button class="btn" onclick="testQuizEngine()">Run Test</button>
            <div id="test2Result" class="log"></div>
        </div>
    </div>

    <!-- Test 3: Scoring System -->
    <div class="test-container">
        <div id="test3" class="test-section test-pending">
            <h3>Test 3: Scoring & Feedback System</h3>
            <p>Test scoring algoritme og instant feedback</p>
            
            <div class="quiz-preview">
                <h4>Scoring Demo:</h4>
                <div id="scoringDemo">
                    <div class="option" onclick="testAnswer(this, true)">Correct Answer</div>
                    <div class="option" onclick="testAnswer(this, false)">Wrong Answer 1</div>
                    <div class="option" onclick="testAnswer(this, false)">Wrong Answer 2</div>
                </div>
                <div id="feedbackDemo"></div>
            </div>
            
            <button class="btn" onclick="testScoringSystem()">Run Test</button>
            <div id="test3Result" class="log"></div>
        </div>
    </div>

    <!-- Test 4: Progress Tracking -->
    <div class="test-container">
        <div id="test4" class="test-section test-pending">
            <h3>Test 4: Progress Tracking & Statistics</h3>
            <p>Test bruger progress tracking og statistikker</p>
            
            <div class="quiz-preview">
                <h4>Progress Demo:</h4>
                <div id="progressDemo">
                    <div>Quiz Attempts: <span id="attemptCount">0</span></div>
                    <div>Average Score: <span id="avgScore">0%</span></div>
                    <div>Best Score: <span id="bestScore">0%</span></div>
                </div>
            </div>
            
            <button class="btn" onclick="testProgressTracking()">Run Test</button>
            <div id="test4Result" class="log"></div>
        </div>
    </div>

    <!-- Test 5: User Interface -->
    <div class="test-container">
        <div id="test5" class="test-section test-pending">
            <h3>Test 5: User Interface & Mobile Optimization</h3>
            <p>Test responsive design og mobile touch events</p>
            
            <div class="quiz-preview">
                <h4>UI Demo:</h4>
                <div id="uiDemo">
                    <button class="btn" onclick="testMobileTouch()">Test Touch Events</button>
                    <button class="btn" onclick="testKeyboardNavigation()">Test Keyboard Nav</button>
                    <button class="btn" onclick="testResponsiveDesign()">Test Responsive</button>
                </div>
            </div>
            
            <button class="btn" onclick="testUserInterface()">Run Test</button>
            <div id="test5Result" class="log"></div>
        </div>
    </div>

    <script>
        // Test Results Tracking
        let testResults = {
            passed: 0,
            failed: 0,
            total: 0
        };

        // Mock Quiz Data for Testing
        const mockQuizData = {
            categories: ["basics", "chromatography", "troubleshooting"],
            questions: [
                {
                    id: "q1",
                    question: "Hvilken metode bruges til at skille proteiner efter st√∏rrelse?",
                    options: [
                        "Ionbytning kromatografi",
                        "St√∏rrelses-exclusion kromatografi", 
                        "Hydrofobisk kromatografi",
                        "Affinitets kromatografi"
                    ],
                    correct: 1,
                    explanation: "St√∏rrelses-exclusion kromatografi separerer baseret p√• molekyl√¶r st√∏rrelse",
                    difficulty: 2,
                    category: "chromatography"
                }
            ]
        };

        // Quiz Engine Mock
        class QuizEngine {
            constructor() {
                this.questions = [];
                this.currentQuestion = 0;
                this.score = 0;
                this.answers = [];
            }

            loadQuestions(questions) {
                this.questions = [...questions];
                this.shuffleQuestions();
            }

            shuffleQuestions() {
                for (let i = this.questions.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [this.questions[i], this.questions[j]] = [this.questions[j], this.questions[i]];
                }
            }

            getCurrentQuestion() {
                return this.questions[this.currentQuestion];
            }

            submitAnswer(answerIndex) {
                const question = this.getCurrentQuestion();
                const isCorrect = answerIndex === question.correct;
                
                this.answers.push({
                    questionId: question.id,
                    selectedAnswer: answerIndex,
                    correct: isCorrect,
                    timestamp: new Date()
                });

                if (isCorrect) {
                    this.score++;
                }

                return {
                    correct: isCorrect,
                    explanation: question.explanation,
                    correctAnswer: question.options[question.correct]
                };
            }

            nextQuestion() {
                this.currentQuestion++;
                return this.currentQuestion < this.questions.length;
            }

            getResults() {
                return {
                    score: this.score,
                    total: this.questions.length,
                    percentage: Math.round((this.score / this.questions.length) * 100),
                    answers: this.answers
                };
            }
        }

        // Test Functions
        function logTest(testId, message, isError = false) {
            const resultDiv = document.getElementById(testId + 'Result');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}\n`;
            resultDiv.textContent += logEntry;
            
            if (isError) {
                console.error(message);
            } else {
                console.log(message);
            }
        }

        function updateTestStatus(testId, passed) {
            const testDiv = document.getElementById(testId);
            testDiv.className = `test-section ${passed ? 'test-passed' : 'test-failed'}`;
            
            if (passed) {
                testResults.passed++;
            } else {
                testResults.failed++;
            }
            testResults.total++;
            updateTestSummary();
        }

        function updateTestSummary() {
            document.getElementById('passedCount').textContent = testResults.passed;
            document.getElementById('failedCount').textContent = testResults.failed;
            document.getElementById('totalCount').textContent = testResults.total;
            
            const status = testResults.failed === 0 && testResults.total > 0 ? 
                'All tests passed! ‚úÖ' : 
                testResults.total === 0 ? 'Pending...' : `${testResults.failed} test(s) failed ‚ùå`;
            document.getElementById('testStatus').textContent = status;
        }

        async function testQuizDataStructure() {
            logTest('test1', 'Testing quiz data structure...');
            
            try {
                // Test 1: Validate question structure
                const question = mockQuizData.questions[0];
                logTest('test1', `‚úì Sample question loaded: ${question.question}`);
                
                // Update sample question display
                document.getElementById('sampleQuestion').innerHTML = `
                    <strong>Q:</strong> ${question.question}<br>
                    <strong>Options:</strong><br>
                    ${question.options.map((opt, i) => `${i + 1}. ${opt}`).join('<br>')}
                    <br><strong>Correct:</strong> ${question.options[question.correct]}
                `;

                // Test required fields
                const requiredFields = ['id', 'question', 'options', 'correct', 'explanation', 'category'];
                for (let field of requiredFields) {
                    if (question[field] === undefined) {
                        throw new Error(`Missing required field: ${field}`);
                    }
                }
                logTest('test1', '‚úì All required fields present');

                // Test options array
                if (!Array.isArray(question.options) || question.options.length < 2) {
                    throw new Error('Options must be array with at least 2 choices');
                }
                logTest('test1', `‚úì Valid options array with ${question.options.length} choices`);

                // Test correct answer index
                if (question.correct < 0 || question.correct >= question.options.length) {
                    throw new Error('Correct answer index out of range');
                }
                logTest('test1', '‚úì Valid correct answer index');

                logTest('test1', 'üéâ Quiz data structure test PASSED');
                updateTestStatus('test1', true);
                
            } catch (error) {
                logTest('test1', `‚ùå Error: ${error.message}`, true);
                updateTestStatus('test1', false);
            }
        }

        async function testQuizEngine() {
            logTest('test2', 'Testing quiz engine...');
            
            try {
                const engine = new QuizEngine();
                
                // Test loading questions
                engine.loadQuestions(mockQuizData.questions);
                logTest('test2', '‚úì Questions loaded successfully');
                
                // Update demo display
                document.getElementById('currentQuestionNum').textContent = '1';
                document.getElementById('totalQuestions').textContent = engine.questions.length;
                document.getElementById('currentScore').textContent = '0';

                // Test getting current question
                const currentQ = engine.getCurrentQuestion();
                if (!currentQ) {
                    throw new Error('Failed to get current question');
                }
                logTest('test2', `‚úì Current question retrieved: ${currentQ.id}`);

                // Test answer submission
                const result = engine.submitAnswer(1);
                if (typeof result.correct !== 'boolean') {
                    throw new Error('Answer submission failed');
                }
                logTest('test2', `‚úì Answer submitted, correct: ${result.correct}`);
                
                // Update score display
                document.getElementById('currentScore').textContent = engine.score;

                // Test results
                const finalResults = engine.getResults();
                if (!finalResults.score && finalResults.score !== 0) {
                    throw new Error('Failed to get results');
                }
                logTest('test2', `‚úì Results calculated: ${finalResults.percentage}%`);

                logTest('test2', 'üéâ Quiz engine test PASSED');
                updateTestStatus('test2', true);
                
            } catch (error) {
                logTest('test2', `‚ùå Error: ${error.message}`, true);
                updateTestStatus('test2', false);
            }
        }

        async function testScoringSystem() {
            logTest('test3', 'Testing scoring system...');
            
            try {
                // Test scoring calculation
                const testScores = [10, 8, 6, 9, 7];
                const average = testScores.reduce((a, b) => a + b) / testScores.length;
                const best = Math.max(...testScores);
                
                if (average !== 8) {
                    throw new Error('Average calculation failed');
                }
                logTest('test3', `‚úì Average score calculated: ${average}`);
                
                if (best !== 10) {
                    throw new Error('Best score calculation failed');
                }
                logTest('test3', `‚úì Best score calculated: ${best}`);

                // Test percentage calculation
                const percentage = Math.round((7 / 10) * 100);
                if (percentage !== 70) {
                    throw new Error('Percentage calculation failed');
                }
                logTest('test3', `‚úì Percentage calculated: ${percentage}%`);

                // Test feedback generation
                const feedback = percentage >= 80 ? 'Excellent!' : 
                               percentage >= 60 ? 'Good job!' : 'Keep practicing!';
                logTest('test3', `‚úì Feedback generated: ${feedback}`);

                logTest('test3', 'üéâ Scoring system test PASSED');
                updateTestStatus('test3', true);
                
            } catch (error) {
                logTest('test3', `‚ùå Error: ${error.message}`, true);
                updateTestStatus('test3', false);
            }
        }

        async function testProgressTracking() {
            logTest('test4', 'Testing progress tracking...');
            
            try {
                // Mock localStorage operations
                const mockProgress = {
                    attempts: 5,
                    scores: [70, 80, 85, 90, 95],
                    categories: {
                        'basics': { correct: 15, total: 20 },
                        'chromatography': { correct: 18, total: 25 }
                    }
                };

                // Update progress display
                document.getElementById('attemptCount').textContent = mockProgress.attempts;
                
                const avgScore = mockProgress.scores.reduce((a, b) => a + b) / mockProgress.scores.length;
                document.getElementById('avgScore').textContent = Math.round(avgScore) + '%';
                
                const bestScore = Math.max(...mockProgress.scores);
                document.getElementById('bestScore').textContent = bestScore + '%';

                // Test data persistence simulation
                logTest('test4', '‚úì Progress data structure validated');
                logTest('test4', `‚úì Average score: ${Math.round(avgScore)}%`);
                logTest('test4', `‚úì Best score: ${bestScore}%`);
                logTest('test4', `‚úì Total attempts: ${mockProgress.attempts}`);

                // Test category performance
                for (let category in mockProgress.categories) {
                    const catData = mockProgress.categories[category];
                    const catPercentage = Math.round((catData.correct / catData.total) * 100);
                    logTest('test4', `‚úì ${category}: ${catPercentage}% (${catData.correct}/${catData.total})`);
                }

                logTest('test4', 'üéâ Progress tracking test PASSED');
                updateTestStatus('test4', true);
                
            } catch (error) {
                logTest('test4', `‚ùå Error: ${error.message}`, true);
                updateTestStatus('test4', false);
            }
        }

        async function testUserInterface() {
            logTest('test5', 'Testing user interface...');
            
            try {
                // Test responsive design
                const isMobile = window.innerWidth <= 768;
                logTest('test5', `‚úì Screen width: ${window.innerWidth}px (${isMobile ? 'Mobile' : 'Desktop'})`);

                // Test touch events (simulated)
                const touchSupported = 'ontouchstart' in window;
                logTest('test5', `‚úì Touch events ${touchSupported ? 'supported' : 'not supported'}`);

                // Test keyboard navigation
                const keyboardNavigation = document.addEventListener ? true : false;
                logTest('test5', `‚úì Keyboard events ${keyboardNavigation ? 'supported' : 'not supported'}`);

                // Test CSS animations
                const animationSupported = CSS.supports('animation', 'none');
                logTest('test5', `‚úì CSS animations ${animationSupported ? 'supported' : 'not supported'}`);

                logTest('test5', 'üéâ User interface test PASSED');
                updateTestStatus('test5', true);
                
            } catch (error) {
                logTest('test5', `‚ùå Error: ${error.message}`, true);
                updateTestStatus('test5', false);
            }
        }

        // Interactive Demo Functions
        function testAnswer(element, isCorrect) {
            // Reset all options
            document.querySelectorAll('.option').forEach(opt => {
                opt.className = 'option';
            });
            
            // Mark selected answer
            element.className = `option ${isCorrect ? 'correct' : 'incorrect'}`;
            
            // Show feedback
            const feedback = isCorrect ? 
                '‚úÖ Correct! Great job!' : 
                '‚ùå Incorrect. The right answer is highlighted in green.';
            
            document.getElementById('feedbackDemo').innerHTML = `<strong>${feedback}</strong>`;
            
            if (isCorrect) {
                // Highlight correct answer after delay for incorrect selection
                setTimeout(() => {
                    document.querySelector('.option:first-child').className = 'option correct';
                }, 1000);
            }
        }

        function testMobileTouch() {
            alert('Touch test: This would test swipe gestures and touch responsiveness on a real device.');
        }

        function testKeyboardNavigation() {
            alert('Keyboard test: Arrow keys for navigation, Enter to select, Space for hints.');
        }

        function testResponsiveDesign() {
            const width = window.innerWidth;
            alert(`Current viewport: ${width}px wide. Responsive breakpoints tested: 768px (tablet), 480px (mobile)`);
        }

        // Main Test Runner
        async function runAllTests() {
            logTest('test1', 'üöÄ Starting comprehensive quiz module tests...');
            
            // Reset test results
            testResults = { passed: 0, failed: 0, total: 0 };
            updateTestSummary();
            
            // Run all tests in sequence
            await testQuizDataStructure();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testQuizEngine();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testScoringSystem();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testProgressTracking();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testUserInterface();
            
            // Final summary
            console.log(`Quiz module tests completed: ${testResults.passed}/${testResults.total} passed`);
        }

        function clearResults() {
            ['test1', 'test2', 'test3', 'test4', 'test5'].forEach(testId => {
                document.getElementById(testId + 'Result').textContent = '';
                document.getElementById(testId).className = 'test-section test-pending';
            });
            
            testResults = { passed: 0, failed: 0, total: 0 };
            updateTestSummary();
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Quiz module tests loaded successfully');
            logTest('test1', 'Test environment initialized - ready to run tests');
        });
    </script>
</body>
</html>
