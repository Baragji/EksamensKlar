<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🧪 ExamKlar - Complete Test Suite</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, sans-serif; 
            max-width: 1000px; 
            margin: 0 auto; 
            padding: 20px;
            background: #f8f9fa;
        }
        .test-section { 
            background: white; 
            padding: 20px; 
            margin: 20px 0; 
            border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-case { 
            border: 1px solid #dee2e6; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 5px; 
        }
        .pass { border-color: #28a745; background: #d4edda; }
        .fail { border-color: #dc3545; background: #f8d7da; }
        .pending { border-color: #ffc107; background: #fff3cd; }
        .running { border-color: #17a2b8; background: #d1ecf1; }
        button { 
            background: #007bff; 
            color: white; 
            border: none; 
            padding: 15px 30px; 
            border-radius: 5px; 
            cursor: pointer; 
            margin: 10px;
            font-size: 1rem;
            font-weight: bold;
        }
        button:hover { background: #0056b3; }
        .test-results {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9rem;
        }
        .summary {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }
        .summary h2 {
            color: #1976d2;
            margin-bottom: 15px;
        }
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .stat {
            background: white;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
        }
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #1976d2;
        }
        .stat-label {
            font-size: 0.9rem;
            color: #666;
        }
    </style>
</head>
<body>
    <h1>🧪 ExamKlar - Complete Test Suite</h1>
    <p><strong>Comprehensive testing of alle implementerede moduler</strong></p>

    <div class="summary">
        <h2>🎯 Test Status Overview</h2>
        <div id="overallStatus">Ready to run tests...</div>
        <div class="summary-stats">
            <div class="stat">
                <div class="stat-number" id="totalTests">0</div>
                <div class="stat-label">Total Tests</div>
            </div>
            <div class="stat">
                <div class="stat-number" id="passedTests">0</div>
                <div class="stat-label">Passed</div>
            </div>
            <div class="stat">
                <div class="stat-number" id="failedTests">0</div>
                <div class="stat-label">Failed</div>
            </div>
            <div class="stat">
                <div class="stat-number" id="successRate">0%</div>
                <div class="stat-label">Success Rate</div>
            </div>
        </div>
    </div>

    <div style="text-align: center; margin: 30px 0;">
        <button onclick="runAllTests()" id="runButton">🚀 Run All Tests</button>
        <button onclick="runContentTests()" style="background: #28a745;">📚 Test Content Module</button>
        <button onclick="runFlashcardTests()" style="background: #dc3545;">🗂️ Test Flashcard Module</button>
        <button onclick="clearResults()" style="background: #6c757d;">🗑️ Clear Results</button>
    </div>

    <div class="test-section">
        <h2>📚 Content Module Tests</h2>
        <div id="contentTests">
            <div class="test-case pending" id="contentTest1">
                <h3>✅ Content Creation Test</h3>
                <p>Test: Can create and store learning content</p>
                <div class="test-results" id="contentResult1"></div>
            </div>
            <div class="test-case pending" id="contentTest2">
                <h3>📖 Content Reading Test</h3>
                <p>Test: Can read and navigate content</p>
                <div class="test-results" id="contentResult2"></div>
            </div>
            <div class="test-case pending" id="contentTest3">
                <h3>🔖 Bookmark System Test</h3>
                <p>Test: Can bookmark and track progress</p>
                <div class="test-results" id="contentResult3"></div>
            </div>
            <div class="test-case pending" id="contentTest4">
                <h3>💾 Data Persistence Test</h3>
                <p>Test: Data saves and loads correctly</p>
                <div class="test-results" id="contentResult4"></div>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>🗂️ Flashcard Module Tests</h2>
        <div id="flashcardTests">
            <div class="test-case pending" id="flashcardTest1">
                <h3>🎴 Card Creation Test</h3>
                <p>Test: Can create flashcards with front/back content</p>
                <div class="test-results" id="flashcardResult1"></div>
            </div>
            <div class="test-case pending" id="flashcardTest2">
                <h3>🧠 Spaced Repetition Test</h3>
                <p>Test: Algorithm correctly calculates intervals</p>
                <div class="test-results" id="flashcardResult2"></div>
            </div>
            <div class="test-case pending" id="flashcardTest3">
                <h3>🔄 Card Animation Test</h3>
                <p>Test: Flip animations work smoothly</p>
                <div class="test-results" id="flashcardResult3"></div>
            </div>
            <div class="test-case pending" id="flashcardTest4">
                <h3>📊 Review Session Test</h3>
                <p>Test: Complete review workflow functions</p>
                <div class="test-results" id="flashcardResult4"></div>
            </div>
            <div class="test-case pending" id="flashcardTest5">
                <h3>📱 Mobile Gestures Test</h3>
                <p>Test: Touch gestures work on mobile</p>
                <div class="test-results" id="flashcardResult5"></div>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>🔗 Integration Tests</h2>
        <div id="integrationTests">
            <div class="test-case pending" id="integrationTest1">
                <h3>🔄 Cross-Module Communication</h3>
                <p>Test: Modules can share data and state</p>
                <div class="test-results" id="integrationResult1"></div>
            </div>
            <div class="test-case pending" id="integrationTest2">
                <h3>💾 Global Data Management</h3>
                <p>Test: localStorage works across modules</p>
                <div class="test-results" id="integrationResult2"></div>
            </div>
            <div class="test-case pending" id="integrationTest3">
                <h3>📱 Responsive Design Test</h3>
                <p>Test: All modules work on mobile devices</p>
                <div class="test-results" id="integrationResult3"></div>
            </div>
        </div>
    </div>

    <script>
        class ExamKlarTestSuite {
            constructor() {
                this.testResults = {
                    total: 0,
                    passed: 0,
                    failed: 0,
                    errors: []
                };
                this.isRunning = false;
            }

            async runAllTests() {
                if (this.isRunning) return;
                
                this.isRunning = true;
                this.resetResults();
                this.updateButton('⏳ Running Tests...', true);
                
                try {
                    await this.runContentTests();
                    await this.runFlashcardTests();
                    await this.runIntegrationTests();
                    
                    this.showFinalResults();
                } catch (error) {
                    this.logError('Test suite error', error);
                } finally {
                    this.isRunning = false;
                    this.updateButton('🚀 Run All Tests', false);
                }
            }

            async runContentTests() {
                await this.runTest('contentTest1', 'Content Creation', async () => {
                    // Test content creation functionality
                    const testContent = {
                        title: 'Test Lesson',
                        content: 'This is **test** content with *markdown*.',
                        duration: 10,
                        difficulty: 2
                    };

                    // Simulate content manager
                    const contentKey = 'test-examklar-content';
                    const testData = {
                        program: { title: 'Test Program', totalDays: 1 },
                        days: [testContent],
                        metadata: { version: '1.0' }
                    };

                    localStorage.setItem(contentKey, JSON.stringify(testData));
                    const retrieved = JSON.parse(localStorage.getItem(contentKey));

                    if (!retrieved || !retrieved.days || retrieved.days.length === 0) {
                        throw new Error('Content not stored correctly');
                    }

                    if (retrieved.days[0].title !== testContent.title) {
                        throw new Error('Content data mismatch');
                    }

                    localStorage.removeItem(contentKey);
                    return 'Content creation and storage: ✅ PASS';
                });

                await this.runTest('contentTest2', 'Content Reading', async () => {
                    // Test markdown parsing
                    const markdown = '# Header\n\n**Bold** and *italic* text\n\n- List item';
                    const expectedHtml = markdown
                        .replace(/^# (.*$)/gim, '<h1>$1</h1>')
                        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                        .replace(/\*(.*?)\*/g, '<em>$1</em>');

                    if (!expectedHtml.includes('<h1>') || !expectedHtml.includes('<strong>')) {
                        throw new Error('Markdown parsing failed');
                    }

                    return 'Markdown parsing and content reading: ✅ PASS';
                });

                await this.runTest('contentTest3', 'Bookmark System', async () => {
                    // Test bookmark functionality
                    const bookmarks = [1, 3, 5];
                    localStorage.setItem('test-examklar-bookmarks', JSON.stringify(bookmarks));
                    
                    const retrieved = JSON.parse(localStorage.getItem('test-examklar-bookmarks'));
                    if (!Array.isArray(retrieved) || retrieved.length !== 3) {
                        throw new Error('Bookmark storage failed');
                    }

                    localStorage.removeItem('test-examklar-bookmarks');
                    return 'Bookmark system: ✅ PASS';
                });

                await this.runTest('contentTest4', 'Data Persistence', async () => {
                    // Test data persistence
                    const testKey = 'test-persistence';
                    const testData = { test: true, timestamp: Date.now() };
                    
                    localStorage.setItem(testKey, JSON.stringify(testData));
                    const retrieved = JSON.parse(localStorage.getItem(testKey));
                    
                    if (!retrieved || !retrieved.test) {
                        throw new Error('Data persistence failed');
                    }

                    localStorage.removeItem(testKey);
                    return 'Data persistence: ✅ PASS';
                });
            }

            async runFlashcardTests() {
                await this.runTest('flashcardTest1', 'Card Creation', async () => {
                    // Test flashcard creation
                    const testCard = {
                        id: 'test-card-' + Date.now(),
                        front: 'Test Question',
                        back: 'Test Answer',
                        difficulty: 2,
                        repetitions: 0,
                        easiness: 2.5,
                        interval: 1
                    };

                    const flashcardData = {
                        flashcards: [testCard],
                        categories: [{ id: 'test', name: 'Test Category' }],
                        metadata: { totalCards: 1 }
                    };

                    localStorage.setItem('test-examklar-flashcards', JSON.stringify(flashcardData));
                    const retrieved = JSON.parse(localStorage.getItem('test-examklar-flashcards'));

                    if (!retrieved.flashcards || retrieved.flashcards.length === 0) {
                        throw new Error('Flashcard creation failed');
                    }

                    localStorage.removeItem('test-examklar-flashcards');
                    return 'Flashcard creation: ✅ PASS';
                });

                await this.runTest('flashcardTest2', 'Spaced Repetition', async () => {
                    // Test spaced repetition algorithm
                    const card = {
                        repetitions: 0,
                        easiness: 2.5,
                        interval: 1,
                        difficulty: 2
                    };

                    // Simulate correct answer (quality = 2)
                    const quality = 2;
                    card.easiness = Math.max(1.3, 
                        card.easiness + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02))
                    );
                    card.repetitions++;
                    
                    if (card.repetitions === 1) {
                        card.interval = 1;
                    } else if (card.repetitions === 2) {
                        card.interval = 6;
                    } else {
                        card.interval = Math.round(card.interval * card.easiness);
                    }

                    if (card.interval <= 0 || card.easiness < 1.3) {
                        throw new Error('Spaced repetition algorithm error');
                    }

                    return `Spaced repetition: ✅ PASS (interval: ${card.interval}, easiness: ${card.easiness.toFixed(2)})`;
                });

                await this.runTest('flashcardTest3', 'Card Animation', async () => {
                    // Test CSS animation support
                    const testDiv = document.createElement('div');
                    testDiv.style.transition = 'transform 0.3s ease';
                    testDiv.style.transform = 'rotateY(180deg)';
                    document.body.appendChild(testDiv);

                    // Check if transform is applied
                    const computedStyle = window.getComputedStyle(testDiv);
                    const hasTransform = computedStyle.transform !== 'none';

                    document.body.removeChild(testDiv);

                    if (!hasTransform) {
                        throw new Error('CSS transforms not supported');
                    }

                    return 'CSS animations and transforms: ✅ PASS';
                });

                await this.runTest('flashcardTest4', 'Review Session', async () => {
                    // Test review session workflow
                    const sessionData = {
                        cards: ['card1', 'card2', 'card3'],
                        started: new Date().toISOString()
                    };

                    localStorage.setItem('test-examklar-review-session', JSON.stringify(sessionData));
                    const retrieved = JSON.parse(localStorage.getItem('test-examklar-review-session'));

                    if (!retrieved.cards || retrieved.cards.length !== 3) {
                        throw new Error('Review session data invalid');
                    }

                    localStorage.removeItem('test-examklar-review-session');
                    return 'Review session workflow: ✅ PASS';
                });

                await this.runTest('flashcardTest5', 'Mobile Gestures', async () => {
                    // Test touch event support
                    const touchSupported = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
                    
                    if (!touchSupported) {
                        return 'Mobile gestures: ⚠️ NOT TESTABLE (no touch device)';
                    }

                    return 'Mobile gesture support: ✅ PASS';
                });
            }

            async runIntegrationTests() {
                await this.runTest('integrationTest1', 'Cross-Module Communication', async () => {
                    // Test data sharing between modules
                    const sharedData = { sharedValue: 'test-integration' };
                    localStorage.setItem('examklar-shared', JSON.stringify(sharedData));

                    const contentData = localStorage.getItem('examklar-shared');
                    const flashcardData = localStorage.getItem('examklar-shared');

                    if (contentData !== flashcardData) {
                        throw new Error('Cross-module data sharing failed');
                    }

                    localStorage.removeItem('examklar-shared');
                    return 'Cross-module communication: ✅ PASS';
                });

                await this.runTest('integrationTest2', 'Global Data Management', async () => {
                    // Test localStorage quota and functionality
                    try {
                        const largeData = 'x'.repeat(1000); // 1KB test data
                        localStorage.setItem('test-large-data', largeData);
                        const retrieved = localStorage.getItem('test-large-data');
                        
                        if (retrieved.length !== largeData.length) {
                            throw new Error('Large data storage failed');
                        }

                        localStorage.removeItem('test-large-data');
                        return 'Global data management: ✅ PASS';
                    } catch (error) {
                        throw new Error('localStorage not available or full');
                    }
                });

                await this.runTest('integrationTest3', 'Responsive Design', async () => {
                    // Test viewport and responsive features
                    const viewport = document.querySelector('meta[name="viewport"]');
                    const hasViewport = viewport && viewport.content.includes('width=device-width');

                    const supportsCSSGrid = CSS.supports('display', 'grid');
                    const supportsFlexbox = CSS.supports('display', 'flex');

                    if (!hasViewport) {
                        throw new Error('Missing responsive viewport meta tag');
                    }

                    if (!supportsCSSGrid || !supportsFlexbox) {
                        throw new Error('Missing modern CSS layout support');
                    }

                    return 'Responsive design features: ✅ PASS';
                });
            }

            async runTest(testId, testName, testFunction) {
                const testElement = document.getElementById(testId);
                const resultElement = document.getElementById(testId.replace('Test', 'Result'));
                
                // Mark test as running
                testElement.className = 'test-case running';
                resultElement.textContent = '⏳ Running test...';
                
                try {
                    this.testResults.total++;
                    const result = await testFunction();
                    
                    // Test passed
                    testElement.className = 'test-case pass';
                    resultElement.textContent = result;
                    this.testResults.passed++;
                    
                } catch (error) {
                    // Test failed
                    testElement.className = 'test-case fail';
                    resultElement.textContent = `❌ FAIL: ${error.message}`;
                    this.testResults.failed++;
                    this.testResults.errors.push({ test: testName, error: error.message });
                }

                this.updateStats();
                await this.sleep(500); // Small delay for visual feedback
            }

            updateStats() {
                document.getElementById('totalTests').textContent = this.testResults.total;
                document.getElementById('passedTests').textContent = this.testResults.passed;
                document.getElementById('failedTests').textContent = this.testResults.failed;
                
                const successRate = this.testResults.total > 0 ? 
                    Math.round((this.testResults.passed / this.testResults.total) * 100) : 0;
                document.getElementById('successRate').textContent = `${successRate}%`;
            }

            showFinalResults() {
                const status = document.getElementById('overallStatus');
                const totalTests = this.testResults.total;
                const passedTests = this.testResults.passed;
                const failedTests = this.testResults.failed;

                if (failedTests === 0) {
                    status.innerHTML = `🎉 <strong>ALL TESTS PASSED!</strong><br>
                        ${passedTests}/${totalTests} tests successful<br>
                        ExamKlar is ready for production! 🚀`;
                    status.style.background = '#d4edda';
                    status.style.color = '#155724';
                } else {
                    status.innerHTML = `⚠️ <strong>SOME TESTS FAILED</strong><br>
                        ${passedTests}/${totalTests} tests passed<br>
                        ${failedTests} tests need attention`;
                    status.style.background = '#f8d7da';
                    status.style.color = '#721c24';
                }
            }

            resetResults() {
                this.testResults = { total: 0, passed: 0, failed: 0, errors: [] };
                
                // Reset all test cases to pending
                document.querySelectorAll('.test-case').forEach(test => {
                    test.className = 'test-case pending';
                });
                
                // Clear all result divs
                document.querySelectorAll('.test-results').forEach(result => {
                    result.textContent = '';
                });

                this.updateStats();
                document.getElementById('overallStatus').textContent = 'Ready to run tests...';
                document.getElementById('overallStatus').style.background = '#e3f2fd';
                document.getElementById('overallStatus').style.color = '#1976d2';
            }

            updateButton(text, disabled) {
                const button = document.getElementById('runButton');
                button.textContent = text;
                button.disabled = disabled;
            }

            sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            logError(context, error) {
                console.error(`${context}:`, error);
                this.testResults.errors.push({ context, error: error.message });
            }

            clearResults() {
                this.resetResults();
                // Also clear localStorage test data
                Object.keys(localStorage).forEach(key => {
                    if (key.startsWith('test-') || key.startsWith('examklar-')) {
                        localStorage.removeItem(key);
                    }
                });
            }
        }

        // Global functions
        let testSuite;

        function runAllTests() {
            testSuite.runAllTests();
        }

        function runContentTests() {
            testSuite.resetResults();
            testSuite.runContentTests();
        }

        function runFlashcardTests() {
            testSuite.resetResults();
            testSuite.runFlashcardTests();
        }

        function clearResults() {
            testSuite.clearResults();
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            testSuite = new ExamKlarTestSuite();
            console.log('🧪 ExamKlar Test Suite ready!');
        });
    </script>
</body>
</html>
